<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Reclutamiento - Grupo Norte</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen" style="background-color:#002338;">

  <!-- üîù Header con fondo oscuro y logos -->
  <header class="w-full py-4" style="background-color:#002338;">
    <div class="max-w-5xl mx-auto flex justify-center items-center gap-6">
      <img src="https://github.com/AnalistaGn/dashboard-gn-e/blob/main/Grupo%20%5E%20Norte_%20Creamos%20.png?raw=true" 
           alt="Grupo Norte" class="h-16 object-contain" />
      <img src="https://github.com/AnalistaGn/dashboard-gn-e/blob/main/Norti%CC%81n%20Verde.png?raw=true" 
           alt="Nort√≠n Verde" class="h-16 object-contain" />
    </div>
  </header>

  <!-- Contenido principal -->
  <main class="max-w-5xl mx-auto bg-white shadow-lg rounded-xl p-6 mt-6">
    <h1 class="text-2xl font-bold mb-4 text-center text-gray-800">üìã Sistema de Reclutamiento</h1>

    <!-- Debug Panel -->
    <div class="bg-gray-100 p-4 rounded-lg mb-4">
      <h3 class="font-bold text-gray-700 mb-2">üîß Panel de Debug</h3>
      <div id="debugInfo" class="text-sm text-gray-600"></div>
    </div>

    <!-- Input de b√∫squeda -->
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Escribe nombre, RUT, cargo, email, tel√©fono o fecha..." 
      class="w-full p-3 border rounded-lg mb-6 focus:ring focus:ring-green-300"
    />

    <!-- Bot√≥n de test API -->
    <button id="testApiBtn" class="bg-blue-500 text-white px-4 py-2 rounded mb-4 hover:bg-blue-600">
      üîç Probar conexi√≥n a API
    </button>

    <!-- Resultados -->
    <div id="results" class="space-y-3"></div>
  </main>

  <script>
    const SHEETDB_API_URL = "https://sheetdb.io/api/v1/arqvckj0fb8af";

    function updateDebugInfo(message) {
      const debugDiv = document.getElementById("debugInfo");
      debugDiv.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
    }

    // üîß Funci√≥n para probar la API
    async function testAPI() {
      updateDebugInfo("üîÑ Iniciando prueba de API...");
      
      try {
        const response = await fetch(SHEETDB_API_URL);
        updateDebugInfo(`üì° Respuesta HTTP: ${response.status} ${response.statusText}`);
        
        if (!response.ok) {
          throw new Error(`Error ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        updateDebugInfo(`‚úÖ Datos recibidos: ${data.length} registros`);
        
        if (data.length > 0) {
          updateDebugInfo(`üìã Primer registro: ${JSON.stringify(data[0])}`);
          updateDebugInfo(`üîë Campos disponibles: ${Object.keys(data[0]).join(', ')}`);
        }

        return data;
      } catch (error) {
        updateDebugInfo(`‚ùå Error: ${error.message}`);
        throw error;
      }
    }

    // üîé B√∫squeda mejorada con debug
    async function searchCandidates(query) {
      updateDebugInfo(`üîç Buscando: "${query}"`);
      
      try {
        const response = await fetch(SHEETDB_API_URL);
        if (!response.ok) {
          throw new Error(`Error ${response.status}: ${response.statusText}`);
        }

        const allData = await response.json();
        updateDebugInfo(`üìä Total de registros en la base: ${allData.length}`);

        const sanitizedQuery = query.trim().toLowerCase();
        updateDebugInfo(`üî§ Query procesada: "${sanitizedQuery}"`);

        const filtered = allData.filter(candidato => {
          const matches = [
            candidato.nombre && candidato.nombre.toLowerCase().includes(sanitizedQuery),
            candidato.rut && candidato.rut.toLowerCase().includes(sanitizedQuery),
            candidato.cargo && candidato.cargo.toLowerCase().includes(sanitizedQuery),
            candidato.email && candidato.email.toLowerCase().includes(sanitizedQuery),
            candidato.telefono && candidato.telefono.toLowerCase().includes(sanitizedQuery),
            candidato.fechapostulacion && candidato.fechapostulacion.toLowerCase().includes(sanitizedQuery)
          ];
          
          return matches.some(match => match === true);
        });

        updateDebugInfo(`‚úÖ Resultados filtrados: ${filtered.length} coincidencias`);
        return { success: true, data: filtered };
      } catch (error) {
        updateDebugInfo(`‚ùå Error en b√∫squeda: ${error.message}`);
        return { success: false, error: error.message };
      }
    }

    // üé® Renderizar resultados
    function renderResults(data) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (data.length === 0) {
        resultsDiv.innerHTML = `<p class="text-gray-500">No se encontraron resultados.</p>`;
        return;
      }

      data.forEach(candidato => {
        const card = document.createElement("div");
        card.className = "p-4 rounded-lg shadow-sm text-white";
        card.style.backgroundColor = "#77c25c";

        card.innerHTML = `
          <p><strong>Nombre:</strong> ${candidato.nombre || "-"}</p>
          <p><strong>RUT:</strong> ${candidato.rut || "-"}</p>
          <p><strong>Cargo:</strong> ${candidato.cargo || "-"}</p>
          <p><strong>Email:</strong> ${candidato.email || "-"}</p>
          <p><strong>Tel√©fono:</strong> ${candidato.telefono || "-"}</p>
          <p><strong>Fecha Postulaci√≥n:</strong> ${candidato.fechapostulacion || "-"}</p>
        `;
        resultsDiv.appendChild(card);
      });
    }

    // Event Listeners
    document.getElementById("testApiBtn").addEventListener("click", async () => {
      document.getElementById("debugInfo").innerHTML = "";
      try {
        const data = await testAPI();
        renderResults(data);
      } catch (error) {
        document.getElementById("results").innerHTML = `<p class="text-red-500">‚ùå Error: ${error.message}</p>`;
      }
    });

    document.getElementById("searchInput").addEventListener("input", async (e) => {
      const query = e.target.value;
      if (query.length < 2) {
        document.getElementById("results").innerHTML = `<p class="text-gray-400">Escribe al menos 2 caracteres...</p>`;
        return;
      }

      const result = await searchCandidates(query);
      if (result.success) {
        renderResults(result.data);
      } else {
        document.getElementById("results").innerHTML = `<p class="text-red-500">‚ùå Error: ${result.error}</p>`;
      }
    });

    // Cargar datos iniciales al cargar la p√°gina
    window.addEventListener('load', () => {
      updateDebugInfo("üöÄ Sistema iniciado");
    });
  </script>
</body>
</html>
