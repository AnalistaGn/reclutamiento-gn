<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Reclutamiento con IA - Grupo Norte</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      max-height: 90vh;
      overflow-y: auto;
    }
    .ai-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .ai-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .7; }
    }
    .thinking {
      border: 2px solid #667eea;
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="min-h-screen" style="background-color:#002338;">

  <header class="w-full py-4" style="background-color:#002338;">
    <div class="max-w-5xl mx-auto flex justify-center items-center gap-6">
      <img src="https://github.com/AnalistaGn/dashboard-gn-e/blob/main/Grupo%20%5E%20Norte_%20Creamos%20.png?raw=true" 
           alt="Grupo Norte" class="h-16 object-contain" />
      <img src="https://github.com/AnalistaGn/dashboard-gn-e/blob/main/Norti%CC%81n%20Verde.png?raw=true" 
           alt="NortÃ­n Verde" class="h-16 object-contain" />
    </div>
  </header>

  <main class="max-w-6xl mx-auto bg-white shadow-lg rounded-xl p-6 mt-6">
    <h1 class="text-2xl font-bold mb-4 text-center text-gray-800">ðŸ“‹ Sistema de Reclutamiento con IA</h1>

    <!-- Panel de IA -->
    <div class="ai-gradient rounded-lg mb-4 overflow-hidden shadow-lg">
      <div class="p-3 cursor-pointer flex justify-between items-center" onclick="toggleAIPanel()">
        <div class="flex items-center gap-3">
          <div class="w-6 h-6 bg-white rounded-full ai-pulse flex items-center justify-center">
            <span class="text-purple-600 text-sm font-bold">AI</span>
          </div>
          <h3 class="font-bold text-white">Asistente de IA para Reclutamiento</h3>
        </div>
        <span id="aiArrow" class="transform transition-transform text-white">â–¼</span>
      </div>
      <div id="aiContent" class="p-4 bg-white hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <!-- AnÃ¡lisis de Candidatos -->
          <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border">
            <h4 class="font-bold text-blue-800 mb-2">AnÃ¡lisis de Candidatos</h4>
            <p class="text-sm text-blue-700 mb-3">La IA analiza automÃ¡ticamente los perfiles y recomienda los mejores candidatos.</p>
            <button onclick="analyzeAllCandidates()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm w-full">
              Analizar Candidatos Actuales
            </button>
          </div>

          <!-- GeneraciÃ³n de Preguntas -->
          <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border">
            <h4 class="font-bold text-green-800 mb-2">Preguntas de Entrevista</h4>
            <p class="text-sm text-green-700 mb-3">Genera preguntas personalizadas para cada candidato y puesto.</p>
            <button onclick="generateInterviewQuestions()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm w-full">
              Generar Preguntas
            </button>
          </div>

          <!-- EvaluaciÃ³n de CV -->
          <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border">
            <h4 class="font-bold text-purple-800 mb-2">EvaluaciÃ³n de CV</h4>
            <p class="text-sm text-purple-700 mb-3">Analiza CVs y extrae informaciÃ³n clave automÃ¡ticamente.</p>
            <input type="file" id="cvFile" accept=".pdf,.doc,.docx" class="hidden">
            <button onclick="document.getElementById('cvFile').click()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm w-full">
              Subir y Analizar CV
            </button>
          </div>

          <!-- Chat con IA -->
          <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg border">
            <h4 class="font-bold text-orange-800 mb-2">Consultor IA</h4>
            <p class="text-sm text-orange-700 mb-3">PregÃºntale a la IA sobre estrategias de reclutamiento.</p>
            <button onclick="openAIChat()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded text-sm w-full">
              Abrir Chat con IA
            </button>
          </div>
        </div>
        <!-- Resultados de IA -->
        <div id="aiResults" class="bg-gray-50 rounded-lg p-4 hidden">
          <div class="flex items-center justify-between mb-3">
            <h4 class="font-bold text-gray-800">Resultados del AnÃ¡lisis de IA</h4>
            <button onclick="clearAIResults()" class="text-gray-500 hover:text-gray-700 text-sm">Limpiar</button>
          </div>
          <div id="aiResultsContent" class="space-y-3"></div>
        </div>
      </div>
    </div>

    <!-- Panel de Debug -->
    <div class="bg-gray-100 rounded-lg mb-4 overflow-hidden">
      <div class="p-3 bg-gray-200 cursor-pointer flex justify-between items-center" onclick="toggleDebugPanel()">
        <h3 class="font-bold text-gray-700">ðŸ”§ Panel de Debug</h3>
        <span id="debugArrow" class="transform transition-transform">â–¼</span>
      </div>
      <div id="debugContent" class="p-4 hidden">
        <div id="debugInfo" class="text-sm text-gray-600 max-h-40 overflow-y-auto"></div>
        <button id="testApiBtn" class="bg-blue-500 text-white px-4 py-2 rounded mt-2 hover:bg-blue-600">
          Probar conexiÃ³n a API
        </button>
        <button id="clearDebugBtn" class="bg-gray-500 text-white px-4 py-2 rounded mt-2 ml-2 hover:bg-gray-600">
          Limpiar Log
        </button>
      </div>
    </div>

    <!-- Buscador -->
    <div class="mb-6 flex gap-2">
      <input id="searchInput" type="text" placeholder="Escribe nombre, RUT, cargo, email, telÃ©fono, comuna, empresa o fecha..." class="flex-grow p-3 border rounded-lg focus:ring focus:ring-green-300" />
      <button id="searchBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">Buscar</button>
      <button onclick="smartSearch()" class="ai-gradient text-white px-4 py-2 rounded hover:opacity-90 flex items-center gap-2">
        <span class="w-4 h-4 bg-white rounded-full flex items-center justify-center">
          <span class="text-purple-600 text-xs font-bold">AI</span>
        </span>
        BÃºsqueda IA
      </button>
    </div>

    <!-- Resultados -->
    <div class="bg-gray-50 rounded-lg p-4 mb-6">
      <h2 class="text-xl font-bold mb-4 text-gray-800">Candidatos Encontrados</h2>
      <div id="results" class="space-y-3"></div>
    </div>

    <!-- Historial -->
    <div id="historialSection" class="bg-gray-50 rounded-lg p-4 hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">ðŸ“Š Historial de Gestiones</h2>
        <div class="flex gap-2">
          <button id="downloadExcelBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">ðŸ“Š Descargar Excel</button>
          <button id="downloadPdfBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm">ðŸ“„ Descargar PDF</button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm bg-white rounded-lg shadow">
          <thead class="bg-gray-200">
            <tr>
              <th class="p-3 text-left">Nombre</th>
              <th class="p-3 text-left">RUT</th>
              <th class="p-3 text-left">Cargo</th>
              <th class="p-3 text-left">Estado</th>
              <th class="p-3 text-left">Score IA</th>
              <th class="p-3 text-left">Motivo</th>
              <th class="p-3 text-left">Fecha/Hora</th>
            </tr>
          </thead>
          <tbody id="historialBody"></tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- AquÃ­ siguen los modals (Chat IA + Ficha PostulaciÃ³n) y scripts de ambos sistemas combinados -->

</body>
</html>
