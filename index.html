<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Reclutamiento - Grupo Norte</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen" style="background-color:#002338;">

  <!-- üîù Header con fondo oscuro y logos -->
  <header class="w-full py-4" style="background-color:#002338;">
    <div class="max-w-5xl mx-auto flex justify-center items-center gap-6">
      <img src="https://github.com/AnalistaGn/dashboard-gn-e/blob/main/Grupo%20%5E%20Norte_%20Creamos%20.png?raw=true" 
           alt="Grupo Norte" class="h-16 object-contain" />
      <img src="https://github.com/AnalistaGn/dashboard-gn-e/blob/main/Norti%CC%81n%20Verde.png?raw=true" 
           alt="Nort√≠n Verde" class="h-16 object-contain" />
    </div>
  </header>

  <!-- Contenido principal -->
  <main class="max-w-5xl mx-auto bg-white shadow-lg rounded-xl p-6 mt-6">
    <h1 class="text-2xl font-bold mb-4 text-center text-gray-800">üìã Sistema de Reclutamiento</h1>

    <!-- Input de b√∫squeda -->
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Escribe nombre, RUT, cargo, email, tel√©fono o fecha..." 
      class="w-full p-3 border rounded-lg mb-6 focus:ring focus:ring-green-300"
    />

    <!-- Resultados -->
    <div id="results" class="space-y-3"></div>
  </main>

  <script>
    const SHEETDB_API_URL = "https://sheetdb.io/api/v1/arqvckj0fb8af"; // ‚úÖ tu endpoint

    // üîé B√∫squeda parcial en frontend
    async function searchCandidates(query) {
      try {
        const sanitizedQuery = query.trim().toLowerCase();

        const response = await fetch(SHEETDB_API_URL);
        if (!response.ok) {
          throw new Error(`Error ${response.status}: ${response.statusText}`);
        }

        const allData = await response.json();

        const filtered = allData.filter(candidato =>
          (candidato.nombre && candidato.nombre.toLowerCase().includes(sanitizedQuery)) ||
          (candidato.rut && candidato.rut.toLowerCase().includes(sanitizedQuery)) ||
          (candidato.cargo && candidato.cargo.toLowerCase().includes(sanitizedQuery)) ||
          (candidato.email && candidato.email.toLowerCase().includes(sanitizedQuery)) ||
          (candidato.telefono && candidato.telefono.toLowerCase().includes(sanitizedQuery)) ||
          (candidato.fechapostulacion && candidato.fechapostulacion.toLowerCase().includes(sanitizedQuery))
        );

        return { success: true, data: filtered };
      } catch (error) {
        console.error("Error al buscar candidatos:", error);
        return { success: false, error: error.message };
      }
    }

    // üé® Renderizar resultados
    function renderResults(data) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (data.length === 0) {
        resultsDiv.innerHTML = `<p class="text-gray-500">No se encontraron resultados.</p>`;
        return;
      }

      data.forEach(candidato => {
        const card = document.createElement("div");
        card.className = "p-4 rounded-lg shadow-sm text-white";
        card.style.backgroundColor = "#77c25c"; // ‚úÖ color de tarjeta

        card.innerHTML = `
          <p><strong>Nombre:</strong> ${candidato.nombre || "-"}</p>
          <p><strong>RUT:</strong> ${candidato.rut || "-"}</p>
          <p><strong>Cargo:</strong> ${candidato.cargo || "-"}</p>
          <p><strong>Email:</strong> ${candidato.email || "-"}</p>
          <p><strong>Tel√©fono:</strong> ${candidato.telefono || "-"}</p>
          <p><strong>Fecha Postulaci√≥n:</strong> ${candidato.fechapostulacion || "-"}</p>
        `;
        resultsDiv.appendChild(card);
      });
    }

    // ‚å®Ô∏è Buscar mientras se escribe
    document.getElementById("searchInput").addEventListener("input", async (e) => {
      const query = e.target.value;
      if (query.length < 2) {
        document.getElementById("results").innerHTML = `<p class="text-gray-400">Escribe al menos 2 caracteres...</p>`;
        return;
      }

      const result = await searchCandidates(query);
      if (result.success) {
        renderResults(result.data);
      } else {
        document.getElementById("results").innerHTML = `<p class="text-red-500">‚ùå Error: ${result.error}</p>`;
      }
    });
  </script>
</body>
</html>
