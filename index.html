<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Reclutamiento - Grupo Norte</title>
  <!-- ‚ö†Ô∏è En producci√≥n instala Tailwind en tu proyecto (esto es solo para pruebas) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-3xl mx-auto bg-white shadow-lg rounded-xl p-6">
    <h1 class="text-2xl font-bold mb-4 text-center">üîé B√∫squeda de Candidatos</h1>

    <!-- Input de b√∫squeda -->
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Escribe nombre, RUT, cargo o email..." 
      class="w-full p-3 border rounded-lg mb-4 focus:ring focus:ring-blue-300"
    />

    <!-- Resultados -->
    <div id="results" class="space-y-3"></div>
  </div>

  <script>
    const SHEETDB_API_URL = "https://sheetdb.io/api/v1/arqvckj0fb8af"; // ‚úÖ tu endpoint

    // üîé B√∫squeda parcial (frontend)
    async function searchCandidates(query) {
      try {
        const sanitizedQuery = query.trim().toLowerCase();

        // 1. Traer todos los registros de la hoja
        const response = await fetch(SHEETDB_API_URL);
        if (!response.ok) {
          throw new Error(`Error ${response.status}: ${response.statusText}`);
        }

        const allData = await response.json();

        // 2. Filtrar localmente
        const filtered = allData.filter(candidato =>
          (candidato.nombre && candidato.nombre.toLowerCase().includes(sanitizedQuery)) ||
          (candidato.rut && candidato.rut.toLowerCase().includes(sanitizedQuery)) ||
          (candidato.cargo && candidato.cargo.toLowerCase().includes(sanitizedQuery)) ||
          (candidato.email && candidato.email.toLowerCase().includes(sanitizedQuery))
        );

        return { success: true, data: filtered };
      } catch (error) {
        console.error("Error al buscar candidatos:", error);
        return { success: false, error: error.message };
      }
    }

    // üé® Mostrar resultados en HTML
    function renderResults(data) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (data.length === 0) {
        resultsDiv.innerHTML = `<p class="text-gray-500">No se encontraron resultados.</p>`;
        return;
      }

      data.forEach(candidato => {
        const card = document.createElement("div");
        card.className = "p-4 border rounded-lg shadow-sm bg-gray-50";

        card.innerHTML = `
          <p><strong>Nombre:</strong> ${candidato.nombre || "-"}</p>
          <p><strong>RUT:</strong> ${candidato.rut || "-"}</p>
          <p><strong>Cargo:</strong> ${candidato.cargo || "-"}</p>
          <p><strong>Email:</strong> ${candidato.email || "-"}</p>
        `;
        resultsDiv.appendChild(card);
      });
    }

    // ‚å®Ô∏è Buscar mientras se escribe
    document.getElementById("searchInput").addEventListener("input", async (e) => {
      const query = e.target.value;
      if (query.length < 2) {
        document.getElementById("results").innerHTML = `<p class="text-gray-400">Escribe al menos 2 caracteres...</p>`;
        return;
      }

      const result = await searchCandidates(query);
      if (result.success) {
        renderResults(result.data);
      } else {
        document.getElementById("results").innerHTML = `<p class="text-red-500">‚ùå Error: ${result.error}</p>`;
      }
    });
  </script>
</body>
</html>
